% -------------------------------------------------------------------------
% p1.1
maxofnode=92;
dnode=1;
n1=[1,1,2,3,3,4,4,5,5,6,7,7,8,8,9,10,11,11,12,14,15,15,16,16,17,17,17,18,18,19,20,21,22,23,24,24,25,26,26,27,28,28,29,30,30,31,31,32,33,33,34,35,36,36,36,36,37,38,38,39,40,41,41,42,43,43,44,45,46,46,47,47,47,48,49,49,50,51,51,52,53,53,54,54,55,56,57,57,57,58,60,61,62,62,63,64,64,65,66,66,67,67,68,68,69,69,69,70,70,71,71,72,73,73,74,74,75,76,77,77,78,79,80,81,82,82,83,84,85,86,86,87,87,88,88,89,89,89,90,91];
n2=[75,78,44,45,65,39,63,49,50,59,32,47,9,47,35,34,22,26,25,21,7,31,14,38,40,42,81,81,83,79,86,22,13,13,13,25,11,27,10,12,29,15,30,7,48,32,34,33,34,8,9,45,35,37,16,39,7,39,41,40,2,17,92,43,2,72,3,46,8,55,48,6,5,61,50,53,51,52,59,56,52,54,55,63,3,57,58,60,4,59,62,60,4,85,64,65,76,66,67,76,44,68,69,75,70,71,1,2,43,72,74,73,74,18,1,80,76,77,78,19,79,80,18,82,83,90,84,85,20,87,88,88,92,89,91,20,84,90,91,92];
w=[9.30053761900000,6.40312423700000,9.48683298100000,42.4646912200000,15.2397506500000,45.6097577300000,10.3077640600000,5,8.48528137400000,16.0312195400000,11.4017542500000,12.8062484700000,11.5974135000000,20.7966343400000,4.24264068700000,49.2163590700000,32.6955654500000,9,17.8885438200000,32.6496554300000,38.1837661800000,29.6816441600000,67.4166151600000,34.0587727300000,26.8793601100000,9.84885780200000,40.2243707200000,6.70820393200000,5.38516480700000,4.47213595500000,3.60555127500000,18.0277563800000,9.05538513800000,5,23.8537208800000,18.0277563800000,20.0249843900000,7.43303437400000,35.3836120300000,33.0492057400000,9.48683298100000,47.5184174800000,74.3236167000000,5.83095189500000,7.07106781200000,11.7046999100000,15.5322245700000,5.09901951400000,7.56637297500000,8.27647267900000,5.02493781100000,6.70820393200000,5,5.09901951400000,6.08276253000000,35.0142828000000,30.4138126500000,3,40.0780488500000,17.6776695300000,19.1441897200000,8.50000000000000,46.3168435900000,8.06225774800000,8,8.06225774800000,11.6297033500000,6,9.30053761900000,29.4278779400000,10.1980390300000,14.8660687500000,14.5602197800000,29,10.4403065100000,6.70820393200000,3.80788655300000,4.30116263400000,2.91547594700000,4.24264068700000,8.54400374500000,22.8035085000000,10.0498756200000,24.1867732400000,12.6589889000000,12.3794184000000,7.50000000000000,8.13941029800000,18.6815416900000,7.81024967600000,13.8924439900000,34.7131099200000,3.50000000000000,60.0166643500000,9.05538513800000,5.83095189500000,13.1529464400000,3.16227766000000,4.24264068700000,9.21954445700000,14.7648230600000,4.12310562600000,7.07106781200000,4.52769256900000,5.38516480700000,6.40312423700000,5,8.60232526700000,7.61577310600000,5,6.10327780800000,8.06225774800000,4.03112887400000,19.7230829200000,6.26498204300000,16.9189243200000,3.53553390600000,4.47213595500000,10,9.84885780200000,6.70820393200000,4.47213595500000,8.06225774800000,5.02493781100000,5.40832691300000,8.73212459800000,9.84885780200000,7.28010988900000,4.47213595500000,11.0453610200000,9.34077084600000,4.03112887400000,21.3775583300000,4.03112887400000,3.04138126500000,9.48683298100000,3,3.53553390600000,4.74341649000000,20.0249843900000];
G1 = graph(n1,n2,w);
dop=zeros(93,92);
for i=21:dnode:maxofnode
    [nodeIDs,dist] = nearest(G1, i, 30,'Method','positive');
    [p,mindist]=searchone(nodeIDs,dist,[0,0,0,0]);
    dop(p,i)=1;
end
% -------------------------------------------------------------------------
% p1.2
rsm=zeros(13,20);
dist1=zeros(13,20);
Tdist=zeros(13,20);
numofroad=[ 1  2  3  4  5  6  7  8  9  10 11 12 13    %序号
            12 14 16 21 22 23 24 28 29 30 38 48 62];  %节点号
for i=1:1:length(numofroad)
    for j=1:1:20
        [P,d]=shortestpath(G1,numofroad(2,i),j);
        dist1(i,j)=d;
        Tdist(i,j)=d;
        %ptah(i,j)=P;
    end
end
for i=1:1:length(numofroad)
    for j=20:-1:1
        [Max,rsm(i,j)]=max(Tdist(i,:));
        Tdist(i,rsm(i,j))=-1;
    end
end
%--------------------------------------------------------------------------
%p1.3
imp=[28,38,48,87
   28,38,61,87 
   28,39,48,87 
   28,39,61,87 
   29,38,48,87 
   29,38,61,87 
   29,39,48,87 
   29,39,61,87
   28,38,48,88 
   28,38,61,88 
   28,39,48,88 
   28,39,61,88 
   29,38,48,88 
   29,38,61,88 
   29,39,48,88 
   29,39,61,88
   28,38,48,89 
   28,38,61,89 
   28,39,48,89 
   28,39,61,89 
   29,38,48,89 
   29,38,61,89 
   29,39,48,89 
   29,39,61,89
   28,38,48,90 
   28,38,61,90 
   28,39,48,90 
   28,39,61,90 
   29,38,48,90 
   29,38,61,90 
   29,39,48,90 
   29,39,61,90
   28,38,48,91 
   28,38,61,91 
   28,39,48,91 
   28,39,61,91 
   29,38,48,91 
   29,38,61,91 
   29,39,48,91 
   29,39,61,91
   28,38,48,92 
   28,38,61,92 
   28,39,48,92 
   28,39,61,92 
   29,38,48,92 
   29,38,61,92 
   29,39,48,92 
   29,39,61,92];
DIST=zeros(92,92);
noc=xlsread('cumcm2011B附件2_全市六区交通网路和平台设置的数据表.xls','全市交通路口节点数据','E2:E93');
noc=noc';
a=0.5;
b=0.25;
c=0.1667;
d=0.0833;
aa=0;
bb=0;
cc=0;
dd=0;
for i=1:maxofnode
    for j=1:maxofnode
        [~,DIST(i,j)]=shortestpath(G1,i,j);
    end
end
 for I=1:1:length(imp)
%      dop=zeros(93,92);
    for i=21:dnode:maxofnode
        if i==imp(I,1)||i==imp(I,2)||i==imp(I,3)||i==imp(I,4)
            dop(i,i)=1;
        else
            [nodeIDs,dist] = nearest(G1, i, 30,'Method','positive');
            [p,mindist]=searchone(nodeIDs,dist,imp(I,:));
            dop(p,i)=1;
        end
    end
    wa=WAA(dop,DIST);
    ws=Ws(dop,DIST,wa);
    ca=CAA(dop,noc);
    cs=Cs(dop,noc,ca);
    rus=a*cs+b*ca+c*ws+d*wa;
    if I==1
        min=rus;
        aa=imp(I,1);
        bb=imp(I,2);
        cc=imp(I,3);
        dd=imp(I,4);
    elseif rus<min
        min=rus;
        aa=imp(I,1);
        bb=imp(I,2);
        cc=imp(I,3);
        dd=imp(I,4);
    end
 end